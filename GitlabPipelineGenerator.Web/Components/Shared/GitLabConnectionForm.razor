@using GitlabPipelineGenerator.Web.Models

<EditForm Model="ConnectionModel" OnValidSubmit="OnConnect">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group mb-3">
        <label for="token">GitLab Personal Access Token:</label>
        <InputText id="token" type="password" class="form-control" @bind-Value="ConnectionModel.Token" />
        <small class="form-text text-muted">Create a token at GitLab → User Settings → Access Tokens with 'read_api' and 'read_repository' scopes</small>
    </div>

    <div class="form-group mb-3">
        <label for="groupId">Group ID:</label>
        <InputText id="groupId" class="form-control" @bind-Value="ConnectionModel.GroupId" placeholder="e.g., 12345" />
        <small class="form-text text-muted">Enter the GitLab group ID (numeric) to list projects from</small>
    </div>

    <button type="submit" class="btn btn-primary" disabled="@IsConnecting">
        @if (IsConnecting)
        {
            <span class="spinner-border spinner-border-sm" role="status"></span>
            <span>Connecting...</span>
        }
        else
        {
            <span>Connect to GitLab</span>
        }
    </button>
</EditForm>

<div class="mt-4">
    <h3>Or Search Projects/Groups</h3>
    <div class="input-group mb-3">
        <input class="form-control" value="@SearchTerm" @oninput="@((ChangeEventArgs e) => SearchTermChanged.InvokeAsync(e.Value?.ToString() ?? string.Empty))" placeholder="Search for projects or groups..." @onkeypress="OnSearchKeyPress" />
        <button class="btn btn-outline-secondary" @onclick="OnSearch" disabled="@(IsSearching || string.IsNullOrWhiteSpace(ConnectionModel.Token))">
            @if (IsSearching)
            {
                <span class="spinner-border spinner-border-sm" role="status"></span>
                <span>Searching...</span>
            }
            else
            {
                <span>Search</span>
            }
        </button>
    </div>
    @if (string.IsNullOrWhiteSpace(ConnectionModel.Token))
    {
        <small class="text-muted">Enter your GitLab token above to enable search</small>
    }
</div>

@code {
    [Parameter] public GitLabConnectionModel ConnectionModel { get; set; } = new();
    [Parameter] public bool IsConnecting { get; set; }
    [Parameter] public bool IsSearching { get; set; }
    [Parameter] public string SearchTerm { get; set; } = string.Empty;
    [Parameter] public EventCallback<string> SearchTermChanged { get; set; }
    [Parameter] public EventCallback OnConnect { get; set; }
    [Parameter] public EventCallback OnSearch { get; set; }
    [Parameter] public EventCallback<KeyboardEventArgs> OnSearchKeyPress { get; set; }
}